<!DOCTYPE HTML>
<!-- NewPage -->
<html lang="en">
<head>
<!-- Generated by javadoc -->
<title>UserProfileMigration</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<link rel="stylesheet" type="text/css" href="../../../stylesheet.css" title="Style">
<link rel="stylesheet" type="text/css" href="../../../jquery/jquery-ui.css" title="Style">
<script type="text/javascript" src="../../../script.js"></script>
<script type="text/javascript" src="../../../jquery/jszip/dist/jszip.min.js"></script>
<script type="text/javascript" src="../../../jquery/jszip-utils/dist/jszip-utils.min.js"></script>
<!--[if IE]>
<script type="text/javascript" src="../../../jquery/jszip-utils/dist/jszip-utils-ie.min.js"></script>
<![endif]-->
<script type="text/javascript" src="../../../jquery/jquery-3.5.1.js"></script>
<script type="text/javascript" src="../../../jquery/jquery-ui.js"></script>
</head>
<body>
<script type="text/javascript"><!--
    try {
        if (location.href.indexOf('is-external=true') == -1) {
            parent.document.title="UserProfileMigration";
        }
    }
    catch(err) {
    }
//-->
var data = {"i0":6,"i1":6};
var tabs = {65535:["t0","All Methods"],2:["t2","Instance Methods"],4:["t3","Abstract Methods"]};
var altColor = "altColor";
var rowColor = "rowColor";
var tableTab = "tableTab";
var activeTableTab = "activeTableTab";
var pathtoroot = "../../../";
var useModuleDirectories = true;
loadScripts(document, 'script');</script>
<noscript>
<div>JavaScript is disabled on your browser.</div>
</noscript>
<header role="banner">
<nav role="navigation">
<div class="fixedNav">
<!-- ========= START OF TOP NAVBAR ======= -->
<div class="topNav"><a id="navbar.top">
<!--   -->
</a>
<div class="skipNav"><a href="#skip.navbar.top" title="Skip navigation links">Skip navigation links</a></div>
<a id="navbar.top.firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../../../index.html">Overview</a></li>
<li><a href="package-summary.html">Package</a></li>
<li class="navBarCell1Rev">Class</li>
<li><a href="class-use/UserProfileMigration.html">Use</a></li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../index-all.html">Index</a></li>
<li><a href="../../../help-doc.html">Help</a></li>
</ul>
</div>
<div class="subNav">
<ul class="navList" id="allclasses_navbar_top">
<li><a href="../../../allclasses.html">All&nbsp;Classes</a></li>
</ul>
<ul class="navListSearch">
<li><label for="search">SEARCH:</label>
<input type="text" id="search" value="search" disabled="disabled">
<input type="reset" id="reset" value="reset" disabled="disabled">
</li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_top");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
<noscript>
<div>JavaScript is disabled on your browser.</div>
</noscript>
</div>
<div>
<ul class="subNavList">
<li>Summary:&nbsp;</li>
<li>Nested&nbsp;|&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li>Constr&nbsp;|&nbsp;</li>
<li><a href="#method.summary">Method</a></li>
</ul>
<ul class="subNavList">
<li>Detail:&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li>Constr&nbsp;|&nbsp;</li>
<li><a href="#method.detail">Method</a></li>
</ul>
</div>
<a id="skip.navbar.top">
<!--   -->
</a></div>
<!-- ========= END OF TOP NAVBAR ========= -->
</div>
<div class="navPadding">&nbsp;</div>
<script type="text/javascript"><!--
$('.navPadding').css('padding-top', $('.fixedNav').css("height"));
//-->
</script>
</nav>
</header>
<!-- ======== START OF CLASS DATA ======== -->
<main role="main">
<div class="header">
<div class="subTitle"><span class="packageLabelInType">Package</span>&nbsp;<a href="package-summary.html">org.micromanager.profile</a></div>
<h2 title="Interface UserProfileMigration" class="title">Interface UserProfileMigration</h2>
</div>
<div class="contentContainer">
<div class="description">
<ul class="blockList">
<li class="blockList">
<hr>
<pre>public interface <span class="typeNameLabel">UserProfileMigration</span></pre>
<div class="block">Interface for object providing user profile setting migration.

 <p>As code evolves and gets refactored, the need sometimes arises to change how
 a particular setting is stored in the user profiles.

 <p>Objects implementing this interface can be registered with the user profile
 system, so that migration of settings is performed automatically.

 <p>Typically, in a class that uses the user profile, you should define the
 profile keys as a static internal enum, like this:</p>
 <pre><code>
 class MyClass {
    private static enum ProfileKey {
       MY_SETTING_1,
       MY_SETTING_2,
    }

    private static final int MY_SETTING_1_DEFAULT = 42;

    // ...
 }
 </code></pre>

 <p>Although this practice is not strictly required (you could use plain string
 constants for the keys), it avoids the mess of having string constants with
 more-or-less the same name and content. You can access the settings like
 this in your code:</p>
 <pre><code>
    int myInteger = profile.getSettings(getClass()).getInteger(
          ProfileKey.MY_SETTING_1.name(),
          MY_SETTING_1_DEFAULT);
 </code></pre>

 <p>Suppose the setting that is now represented by MY_SETTING_1 used to live in
 a different class, com.foo.Bar, under the key "BarSetting". If this is a
 nontrivial setting, you would like the old setting to be automatically
 copied to MY_SETTING_1. To make that happen, extend the enum like this,
 with an added static initialization to register the migration:</p>
 <pre><code>
    private static enum ProfileKey implements UserProfileMigration {
       MY_SETTING_1 {
          @Override
          public void migrate(PropertyMap legacy, MutablePropertyMapView modern) {
             // Perform the migration:
             PropertyMap fooBarSettings = legacy.getPropertyMap("com.foo.Bar",
                   PropertyMaps.emptyPropertyMap());
             if (fooBarSettings.containsInteger("BarSetting")) {
                modern.putInteger(name(), fooBarSettings.getInteger("BarSetting"));
             }
          }
       },
       MY_SETTING_2, // No migration for MY_SETTING_2
       ;
       @Override
       public void migrate(PropertyMap legacy, MutablePropertyMapView modern) { }
    }

    static {
       UserProfileMigrator.registerMigrations(MyClass.class, ProfileKey.values());
    }
 </code></pre>

 <p>That's all you need to do. The user profile system will do the rest of the
 work, so that by the time you access the setting, it will have been
 migrated to the new owner class and key.

 <p>The above example showed a simple 1-to-1 migration (from
 com.foo.Bar:BarSetting to MyClass:MY_SETTING_1), but it is possibly to
 derive the new setting value from more than one legacy setting. This can be
 used to transform the representation of the setting, or to check multiple
 historical places where the setting was stored.

 <p>The <code>migrate</code> method is only ever called if the current setting
 (defined by the class passed to
 <code>UserProfileMigration.registerMigration</code> and the key returned by
 <code>name()</code>) is missing in the user profile. Thus, once the migration has
 happened on a given profile, it will not repeat. (The legacy settings
 remain in the profile.)

 <p>All of the migrations for a given owner class must be registered before any
 of the settings for the class are accessed. Thus, migrations should always
 be registered in a static initializer, as in the example above.

 <p>The <code>legacy</code> property map passed to the <code>migrate</code> method
 contains only the settings saved in the specific user profile, and excludes
 settings in the global or other fallback profile, so if the user was using
 the global default, the migration will be skipped in the above example code.</div>
</li>
</ul>
</div>
<div class="summary">
<ul class="blockList">
<li class="blockList">
<!-- ========== METHOD SUMMARY =========== -->
<section role="region">
<ul class="blockList">
<li class="blockList"><a id="method.summary">
<!--   -->
</a>
<h3>Method Summary</h3>
<table class="memberSummary">
<caption><span id="t0" class="activeTableTab"><span>All Methods</span><span class="tabEnd">&nbsp;</span></span><span id="t2" class="tableTab"><span><a href="javascript:show(2);">Instance Methods</a></span><span class="tabEnd">&nbsp;</span></span><span id="t3" class="tableTab"><span><a href="javascript:show(4);">Abstract Methods</a></span><span class="tabEnd">&nbsp;</span></span></caption>
<tr>
<th class="colFirst" scope="col">Modifier and Type</th>
<th class="colSecond" scope="col">Method</th>
<th class="colLast" scope="col">Description</th>
</tr>
<tr id="i0" class="altColor">
<td class="colFirst"><code>void</code></td>
<th class="colSecond" scope="row"><code><span class="memberNameLink"><a href="#migrate(org.micromanager.PropertyMap,org.micromanager.propertymap.MutablePropertyMapView)">migrate</a></span>&#8203;(<a href="../PropertyMap.html" title="interface in org.micromanager">PropertyMap</a>&nbsp;legacy,
       <a href="../propertymap/MutablePropertyMapView.html" title="interface in org.micromanager.propertymap">MutablePropertyMapView</a>&nbsp;modern)</code></th>
<td class="colLast">
<div class="block">Perform a migration from old settings storage.</div>
</td>
</tr>
<tr id="i1" class="rowColor">
<td class="colFirst"><code>java.lang.String</code></td>
<th class="colSecond" scope="row"><code><span class="memberNameLink"><a href="#name()">name</a></span>()</code></th>
<td class="colLast">
<div class="block">The current (modern) key under which the relevant setting is stored.</div>
</td>
</tr>
</table>
</li>
</ul>
</section>
</li>
</ul>
</div>
<div class="details">
<ul class="blockList">
<li class="blockList">
<!-- ============ METHOD DETAIL ========== -->
<section role="region">
<ul class="blockList">
<li class="blockList"><a id="method.detail">
<!--   -->
</a>
<h3>Method Detail</h3>
<a id="name()">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>name</h4>
<pre class="methodSignature">java.lang.String&nbsp;name()</pre>
<div class="block">The current (modern) key under which the relevant setting is stored.

 <p>If you are using an enum class to implement <code>ProfileMigration</code>,
 this method will be automatically available (see <code>Enum.name()</code>).

 <p>If you are implementing a migration as a plain object (not recommended),
 you will need to implement this method to return the key string.</div>
<dl>
<dt><span class="returnLabel">Returns:</span></dt>
<dd>the profile setting key</dd>
</dl>
</li>
</ul>
<a id="migrate(org.micromanager.PropertyMap,org.micromanager.propertymap.MutablePropertyMapView)">
<!--   -->
</a>
<ul class="blockListLast">
<li class="blockList">
<h4>migrate</h4>
<pre class="methodSignature">void&nbsp;migrate&#8203;(<a href="../PropertyMap.html" title="interface in org.micromanager">PropertyMap</a>&nbsp;legacy,
             <a href="../propertymap/MutablePropertyMapView.html" title="interface in org.micromanager.propertymap">MutablePropertyMapView</a>&nbsp;modern)</pre>
<div class="block">Perform a migration from old settings storage.</div>
<dl>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>legacy</code> - a property map containing existing settings from which to
        migrate, whose keys are the canonical names of the owner classes and
        whose values are nested property maps containing the settings.</dd>
<dd><code>modern</code> - the user profile settings for the class under which this
        migration was registered, to which the migrated settings should be saved</dd>
</dl>
</li>
</ul>
</li>
</ul>
</section>
</li>
</ul>
</div>
</div>
</main>
<!-- ========= END OF CLASS DATA ========= -->
<footer role="contentinfo">
<nav role="navigation">
<!-- ======= START OF BOTTOM NAVBAR ====== -->
<div class="bottomNav"><a id="navbar.bottom">
<!--   -->
</a>
<div class="skipNav"><a href="#skip.navbar.bottom" title="Skip navigation links">Skip navigation links</a></div>
<a id="navbar.bottom.firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../../../index.html">Overview</a></li>
<li><a href="package-summary.html">Package</a></li>
<li class="navBarCell1Rev">Class</li>
<li><a href="class-use/UserProfileMigration.html">Use</a></li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../index-all.html">Index</a></li>
<li><a href="../../../help-doc.html">Help</a></li>
</ul>
</div>
<div class="subNav">
<ul class="navList" id="allclasses_navbar_bottom">
<li><a href="../../../allclasses.html">All&nbsp;Classes</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_bottom");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
<noscript>
<div>JavaScript is disabled on your browser.</div>
</noscript>
</div>
<div>
<ul class="subNavList">
<li>Summary:&nbsp;</li>
<li>Nested&nbsp;|&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li>Constr&nbsp;|&nbsp;</li>
<li><a href="#method.summary">Method</a></li>
</ul>
<ul class="subNavList">
<li>Detail:&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li>Constr&nbsp;|&nbsp;</li>
<li><a href="#method.detail">Method</a></li>
</ul>
</div>
<a id="skip.navbar.bottom">
<!--   -->
</a></div>
<!-- ======== END OF BOTTOM NAVBAR ======= -->
</nav>
</footer>
</body>
</html>
